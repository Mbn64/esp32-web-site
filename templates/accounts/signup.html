{% extends 'base.html' %}
{% load crispy_forms_tags %}

{% block title %}ثبت نام - MBN13{% endblock %}

{% block content %}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-6 col-lg-5">
            <div class="card shadow">
                <div class="card-body p-5">
                    <h2 class="text-center mb-4">
                        <i class="fas fa-user-plus text-primary"></i>
                        ثبت نام
                    </h2>
                    
                    <form method="post" id="signup-form">
                        {% csrf_token %}
                        
                        <div class="mb-3">
                            {{ form.username|as_crispy_field }}
                            <div id="username-feedback" class="form-text"></div>
                        </div>
                        
                        {{ form.email|as_crispy_field }}
                        {{ form.password1|as_crispy_field }}
                        {{ form.password2|as_crispy_field }}
                        
                        <button type="submit" class="btn btn-primary w-100 mb-3">
                            <i class="fas fa-user-plus me-2"></i>
                            ثبت نام
                        </button>
                    </form>
                    
                    <div class="text-center">
                        <p class="mb-0">
                            قبلاً ثبت نام کرده‌اید؟
                            <a href="{% url 'accounts:login' %}">وارد شوید</a>
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// بررسی real-time نام کاربری
let typingTimer;
const doneTypingInterval = 500;
const usernameInput = document.getElementById('id_username');
const usernameFeedback = document.getElementById('username-feedback');

usernameInput.addEventListener('keyup', function() {
    clearTimeout(typingTimer);
    if (usernameInput.value) {
        typingTimer = setTimeout(checkUsername, doneTypingInterval);
    }
});

function checkUsername() {
    const username = usernameInput.value;
    
    fetch(`{% url 'accounts:check_username' %}?username=${username}`)
        .then(response => response.json())
        .then(data => {
            usernameFeedback.textContent = data.message;
            usernameFeedback.className = 'form-text ' + (data.available ? 'text-success' : 'text-danger');
            
            if (data.available) {
                usernameInput.classList.remove('is-invalid');
                usernameInput.classList.add('is-valid');
            } else {
                usernameInput.classList.remove('is-valid');
                usernameInput.classList.add('is-invalid');
            }
        });
}
</script>
{% endblock %}